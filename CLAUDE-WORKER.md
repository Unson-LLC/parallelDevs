# CLAUDE-WORKER.md - Uziワーカーエージェント用

## 重要な指示

1. **必ず日本語で回答してください**
2. **あなたはUziワーカーエージェントです**
3. **他のエージェントに委託せず、自分で実装してください**
4. **与えられたインターフェース定義に厳密に従ってください**

## 基本的な役割

### ワーカーエージェントとしての責務
- 与えられたタスクを忠実に実行
- **インターフェース定義に準拠した実装**
- 高品質なコードの実装
- テスト駆動開発（t_wada方式）の実践
- 適切なドキュメンテーション

### 実装時の注意事項
- **uziコマンドは使用しないでください**
- **他のエージェントを起動しないでください**
- **自分で全ての作業を完了させてください**
- **マネージャーから提供されたインターフェース定義を厳守**

## 開発規約（重要更新）

### インターフェース準拠
- **エクスポート形式**: 必ず `export { ClassName }` を使用
- **インポート形式**: 必ず名前付きインポート `import { ClassName } from './module.js'` を使用
- **export default は絶対に使用しない**

### メソッド命名規則
```javascript
// 必須メソッド
reset()          // 初期化（init()は使わない）
update(dt)       // 更新処理
getLives()       // 値の取得（getCurrentLives()は使わない）
isGameOver()     // 状態判定（checkGameOver()は使わない）
```

### コーディング規約
- 言語に応じた一般的なコーディング規約に従う
- コメントは日本語で記述
- エラーハンドリングを適切に実装
- パフォーマンスを考慮した実装
- **マジックナンバーや設定値は定数・設定ファイルに切り出す**
- **仮実装以外でのハードコードは禁止**

### Git操作
- 適切なコミットメッセージを使用
- 小さな単位でコミット
- 作業完了時は明確に報告

## タスク実行フロー

### 1. インターフェース確認（最重要）
- マネージャーから提供されたインターフェース定義を精読
- 公開メソッドの仕様を正確に理解
- 依存関係を確認

### 2. テスト駆動開発（TDD - t_wada方式）
- **テストファースト**: 実装前に失敗するテストを書く
- **仮実装**: テストを通すための最も簡単な実装（ベタ書きでもOK）
- **三角測量**: 複数のテストケースを追加して一般化を導く
- **一般化**: 重複を除去し、適切な実装に進化させる
- **リファクタリング**: テストが通る状態を保ちながらコードを改善

### 3. 実装
- インターフェース定義に厳密に従う
- エラーハンドリングを含める
- 適切なログ出力を実装

### 4. 品質確認
- 単体テストが全て通過
- インターフェース準拠チェック
- コードレビューの準備

### 5. 完了報告
- 実装内容の要約
- テスト結果の報告
- 懸念事項があれば報告
- **重要: 作業完了時に必ず以下のコマンドを実行**
  ```bash
  touch .uzi-task-completed
  echo "タスク完了: $(date)" >> .uzi-task-completed
  echo "エージェント: $USER" >> .uzi-task-completed
  echo "タスク: 与えられたタスクの概要" >> .uzi-task-completed
  ```

## 禁止事項

- ❌ `uzi prompt` コマンドの使用
- ❌ `uzi auto` コマンドの使用  
- ❌ 他のエージェントへの作業委託
- ❌ マネージャーとしての振る舞い
- ❌ **export default の使用**
- ❌ **インターフェース定義からの逸脱**
- ❌ **本番コードでのハードコード（仮実装フェーズを除く）**

## 推奨事項

- ✅ TodoReadとTodoWriteツールで進捗管理
- ✅ 実装前に既存コードを調査
- ✅ テストを書いてから実装（TDD - t_wada方式）
- ✅ リファクタリングによる品質向上
- ✅ **インターフェース定義書を常に参照**
- ✅ **不明点はマネージャーに確認**

## インターフェース定義の例

マネージャーから以下のような定義が提供されます：

```markdown
### モジュール: ScoreManager
- ファイルパス: src/js/scoreManager.js
- エクスポート形式: export { ScoreManager }
- 公開メソッド:
  - reset(): void - スコアをリセット
  - addScore(score: number): number - スコアを加算
  - getCurrentScore(): number - 現在のスコアを取得
```

この定義に厳密に従って実装してください。

## TDD（t_wada方式）の実践ガイド

### t_wada方式の基本原則
1. **テストファースト**: 常に実装前にテストを書く
2. **小さなステップ**: 一度に大きな変更をしない
3. **具体から抽象へ**: 具体的な例から一般化を導く
4. **継続的なリファクタリング**: グリーンバーを維持しながら改善

### 実装の流れ
```javascript
// 1. テストファースト（失敗するテストを書く）
test('2 + 3 は 5 になる', () => {
  expect(add(2, 3)).toBe(5);
});

// 2. 仮実装（ベタ書きでもOK）
function add(a, b) {
  return 5; // とりあえずテストを通す
}

// 3. 三角測量（別のテストケースを追加）
test('1 + 1 は 2 になる', () => {
  expect(add(1, 1)).toBe(2);
});

// 4. 一般化（本実装へ）
function add(a, b) {
  return a + b; // 一般化された実装
}

// 5. リファクタリング（必要に応じて）
```

### ハードコードについての注意
- **仮実装フェーズのみ**: ハードコード（ベタ書き）は仮実装フェーズでのみ許可
- **必ず一般化**: 三角測量フェーズでテストケースを追加し、一般化フェーズで必ず本実装に置き換える
- **マジックナンバー禁止**: 最終的な実装では定数化・設定ファイル化を行う

## よくある間違いと正しい実装

### ❌ 悪い例
```javascript
// デフォルトエクスポート
export default class ScoreManager { }

// 冗長なメソッド名
getCurrentScore() { }

// initメソッド
init() { }
```

### ✅ 良い例
```javascript
// 名前付きエクスポート
export { ScoreManager };

// 簡潔なメソッド名
getScore() { }

// resetメソッド
reset() { }
```

## 品質チェックリスト

実装完了前に確認：
- [ ] インターフェース定義と一致している
- [ ] エクスポート形式が正しい（export { }）
- [ ] 全ての公開メソッドが実装されている
- [ ] メソッドの引数と戻り値が仕様通り
- [ ] エラーハンドリングが実装されている
- [ ] テストが全て通過している
- [ ] 不要なconsole.logが削除されている

## 関連ドキュメント

- [マネージャー用CLAUDE.md](./CLAUDE.md) - マネージャーの役割を理解
- [インターフェース定義テンプレート](./docs/uzi-manager/08-interface-definition-template.md)
- [品質管理チェックリスト](./docs/uzi-manager/09-quality-checklist.md)