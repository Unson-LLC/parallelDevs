# TDD（t_wada方式）実践ガイド

## t_wada方式の基本原則

1. **テストファースト**: 常に実装前にテストを書く
2. **小さなステップ**: 一度に大きな変更をしない
3. **具体から抽象へ**: 具体的な例から一般化を導く
4. **継続的なリファクタリング**: グリーンバーを維持しながら改善

## 実装の流れ

```javascript
// 1. テストファースト（失敗するテストを書く）
test('2 + 3 は 5 になる', () => {
  expect(add(2, 3)).toBe(5);
});

// 2. 仮実装（ベタ書きでもOK）
function add(a, b) {
  return 5; // とりあえずテストを通す
}

// 3. 三角測量（別のテストケースを追加）
test('1 + 1 は 2 になる', () => {
  expect(add(1, 1)).toBe(2);
});

// 4. 一般化（本実装へ）
function add(a, b) {
  return a + b; // 一般化された実装
}

// 5. リファクタリング（必要に応じて）
```

## ハードコードについての注意

- **仮実装フェーズのみ**: ハードコード（ベタ書き）は仮実装フェーズでのみ許可
- **必ず一般化**: 三角測量フェーズでテストケースを追加し、一般化フェーズで必ず本実装に置き換える
- **マジックナンバー禁止**: 最終的な実装では定数化・設定ファイル化を行う

## TDDサイクルの詳細

### RED（赤）フェーズ
- 失敗するテストを書く
- テストが意図通りに失敗することを確認
- エラーメッセージを確認

### GREEN（緑）フェーズ
- テストを通すための最小限の実装
- ベタ書きでもOK（仮実装）
- とにかくテストを通すことが目的

### REFACTOR（リファクタリング）フェーズ
- テストが通る状態を維持
- コードの重複を除去
- 可読性を向上
- パフォーマンスを改善

## 実践的なヒント

### テストの書き方
- 具体的な値を使う
- 境界値をテストする
- エラーケースを忘れない
- テスト名は日本語でOK

### 仮実装のパターン
```javascript
// パターン1: 定数を返す
function calculate() {
  return 42; // 仮実装
}

// パターン2: 条件分岐
function calculate(x) {
  if (x === 5) return 10;
  if (x === 3) return 6;
  // 徐々に一般化
}

// パターン3: コピー＆ペースト
// 最初は重複を許容し、後で共通化
```

### 三角測量の考え方
- 2つ以上の具体例から一般化を導く
- 異なる入力で同じロジックが適用できることを確認
- 段階的に抽象度を上げる

## よくある失敗と対策

### ❌ 失敗例1: いきなり一般化
```javascript
// 最初から複雑な実装を書いてしまう
function calculateComplexFormula(a, b, c) {
  return Math.sqrt(a * a + b * b) / c; // いきなり本実装
}
```

### ✅ 改善例1: 段階的なアプローチ
```javascript
// ステップ1: 具体的な値で仮実装
function calculate() {
  return 5; // 特定のケースのみ
}

// ステップ2: 別のケースを追加
// ステップ3: パターンを見つけて一般化
```

### ❌ 失敗例2: テストが大きすぎる
```javascript
test('ユーザー登録の全機能', () => {
  // バリデーション、保存、メール送信など
  // 一度に多くをテストしすぎ
});
```

### ✅ 改善例2: 小さく分割
```javascript
test('メールアドレスの形式をチェックする', () => {
  // 1つの振る舞いのみテスト
});

test('パスワードの長さをチェックする', () => {
  // 別の振る舞いを独立してテスト
});
```