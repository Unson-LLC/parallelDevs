# 品質管理チェックリスト

## 概要

このチェックリストは、並列開発時の品質を確保し、今回のような統合時の問題を防ぐためのものです。

## フェーズ別チェックリスト

### 1. 計画フェーズ

#### 要件分析
- [ ] 要件定義書を精読し、不明点を洗い出した
- [ ] モジュール分割案を作成した
- [ ] 各モジュールの責務を明確にした

#### インターフェース設計
- [ ] 全モジュールの公開メソッドを定義した
- [ ] メソッドのパラメータと戻り値を明記した
- [ ] エクスポート形式を統一した（`export { }`）
- [ ] 依存関係マトリクスを作成した

#### テスト設計
- [ ] 統合テストの設計を完了した
- [ ] 各モジュールの単体テスト項目を洗い出した
- [ ] エッジケースとエラーケースを網羅した

### 2. RED フェーズ（テスト作成）

#### 統合テスト
- [ ] モジュール間の連携をテストするコードを作成した
- [ ] インターフェース定義に基づいてテストを作成した
- [ ] 全てのテストが失敗することを確認した

#### 単体テスト
- [ ] 各モジュールの単体テストを作成した
- [ ] 境界値テストを含めた
- [ ] エラーハンドリングのテストを含めた

#### コードレビュー
- [ ] テストコードが要件を網羅していることを確認した
- [ ] テストの可読性を確認した
- [ ] 不要なテストがないことを確認した

### 3. GREEN フェーズ（実装）

#### 実装前チェック
- [ ] インターフェース定義書を各エージェントに配布した
- [ ] 実装の優先順位を決定した
- [ ] 依存関係を考慮した実装順序を決めた

#### 実装中チェック
- [ ] 定期的に `./uzi ls -d` で進捗を確認した
- [ ] インターフェース準拠チェックを実行した
  ```bash
  ./scripts/check-interface-compliance.sh
  ```
- [ ] テストの実行状況を監視した

#### コード品質チェック
- [ ] エクスポート形式が統一されている
- [ ] メソッド名が命名規則に従っている
- [ ] エラーハンドリングが適切に実装されている
- [ ] コメントが適切に記載されている

### 4. 統合フェーズ

#### 段階的統合
- [ ] 1つのモジュールをマージした
- [ ] 単体テストが通過することを確認した
- [ ] 統合テストが通過することを確認した
- [ ] リンターエラーがないことを確認した

#### 統合後チェック
- [ ] 全モジュールの統合が完了した
- [ ] E2Eテストが通過する（該当する場合）
- [ ] パフォーマンステストを実施した（必要に応じて）
- [ ] ドキュメントを更新した

### 5. REFACTOR フェーズ

#### リファクタリング前
- [ ] 全てのテストが通過している
- [ ] リファクタリングの目的を明確にした
- [ ] 影響範囲を特定した

#### リファクタリング後
- [ ] テストが引き続き通過する
- [ ] コード品質メトリクスが改善した
- [ ] パフォーマンスが劣化していない
- [ ] 新たな警告が発生していない

## 自動化ツール

### 1. インターフェース準拠チェック
```bash
# 実行方法
./scripts/check-interface-compliance.sh

# チェック項目
- export default の使用
- 必須メソッドの存在
- 命名規則の遵守
- インポート形式
- クラス定義
- エラーハンドリング
```

### 2. テスト実行
```bash
# 単体テスト
npm test

# 統合テスト
npm run test:integration

# カバレッジ確認
npm run test:coverage
```

### 3. コード品質チェック
```bash
# ESLint
npm run lint

# 型チェック（TypeScriptの場合）
npm run typecheck
```

## トラブルシューティング

### よくある問題と対策

#### 1. エクスポート/インポートの不一致
**症状**: `does not provide an export named 'ClassName'`
**対策**: 
- エクスポート形式を確認（`export { }` を使用）
- インポート文を確認（名前付きインポートを使用）

#### 2. メソッドが見つからない
**症状**: `is not a function`
**対策**:
- インターフェース定義書と実装を照合
- メソッド名の綴りを確認
- thisのバインディングを確認

#### 3. 状態の不整合
**症状**: `無効な状態: STATE_NAME`
**対策**:
- 状態定数の値を確認（大文字ではなく小文字）
- changeStateの呼び出し箇所を確認

## 緊急時の対応

問題が発生した場合の対応手順：

1. **エラーログの収集**
   ```bash
   # ブラウザコンソールのエラーをコピー
   # テスト実行結果を保存
   npm test > test-results.log 2>&1
   ```

2. **影響範囲の特定**
   ```bash
   # 変更されたファイルを確認
   git status
   git diff
   ```

3. **ロールバック（必要に応じて）**
   ```bash
   # 特定のコミットまで戻る
   git reset --hard <commit-hash>
   ```

4. **段階的な修正**
   - 1つのエラーずつ対処
   - 修正後は必ずテストを実行
   - 小さな単位でコミット

## まとめ

このチェックリストを活用することで：
- インターフェースの不整合を防ぐ
- 早期に問題を発見できる
- 品質を維持しながら並列開発が可能
- トラブル時の対応が迅速化

定期的にこのチェックリストを見直し、プロジェクトに合わせて更新してください。