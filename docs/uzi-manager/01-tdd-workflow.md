# TDD開発ワークフロー

## TDD開発フロー概要

### 1. 要件分析とテスト設計
- ユーザーからリポストされた要件定義を分析
- テスト可能な単位に分割
- 各機能のテストケースを設計

### 2. テストコードの作成（RED フェーズ）
- 複数のエージェントにテストコードの作成を割り当て
- 要件を満たすテストケースを網羅的に作成
- テストが失敗することを確認

### 3. 実装コードの作成（GREEN フェーズ）
- テストを通過する最小限の実装を作成
- 複数のエージェントで並行して実装
- 全てのテストが通過することを確認

### 4. リファクタリング（REFACTOR フェーズ）
- コードの品質向上
- 重複の除去
- パフォーマンスの最適化

## TDD開発の具体的なワークフロー

### 1. 要件定義を受け取った後の初動

```bash
# ステップ1: テスト作成エージェントを起動（claudeのみ）
uzi prompt --agents claude:3 "以下の要件に基づいてテストコードを作成してください: [要件定義の内容]"

# 自動確認モードで効率化
uzi auto

# 進捗を監視
uzi ls -w

# テストの網羅性を確認
uzi broadcast "エッジケースのテストも追加してください"
```

### 2. テストコード作成フェーズ（RED）

```bash
# 各エージェントにテストケースを分担（claudeのみ）
uzi prompt --agents claude:4 "機能Aのユニットテスト、機能Bの統合テスト、エラーハンドリングのテスト、エッジケースのテストをそれぞれ作成"

# テストが失敗することを確認
uzi run "go test ./..."

# テスト結果を確認（全て赤になるはず）
uzi broadcast "テストが正しく失敗していることを確認してください"

# 最良のテストコードを選択してマージ
uzi checkpoint test-agent "test: 機能Xのテストケース追加"
```

### 3. 実装フェーズ（GREEN）

```bash
# 実装エージェントを起動（claudeのみ）
uzi prompt --agents claude:5 "先ほど作成したテストを通過する実装を作成してください"

# リアルタイムでテスト実行
uzi run "go test ./... -v"

# 特定のテストケースに注目
uzi broadcast "TestUserAuthentication が失敗しています。認証ロジックを確認してください"

# 全テスト通過を確認したらマージ
uzi checkpoint impl-agent "feat: 機能Xの実装"
```

### 4. リファクタリングフェーズ（REFACTOR）

```bash
# リファクタリング専門エージェントを起動（claudeのみ）
uzi prompt --agents claude:3 "テストを壊さずにコードをリファクタリングしてください"

# 継続的にテストを実行
uzi run "go test ./... && go vet ./..."

# コード品質チェック
uzi run "golint ./..."

# ベストな実装を選択
uzi checkpoint refactor-agent "refactor: コードの最適化"
```

## 品質基準とマージ判断

### REDフェーズの完了基準
- [ ] 要件を網羅するテストケースが存在
- [ ] 全てのテストが失敗している
- [ ] エッジケースが考慮されている

### GREENフェーズの完了基準
- [ ] 全てのテストが通過
- [ ] 最小限の実装である
- [ ] 新たな警告やエラーが発生していない

### REFACTORフェーズの完了基準
- [ ] テストが引き続き通過
- [ ] コード品質メトリクスが改善
- [ ] パフォーマンスが劣化していない

## TDD開発の進捗報告テンプレート

### 1. REDフェーズ完了報告
```
テストコード作成が完了しました：
- 作成したテストケース数: X件
- カバーした要件: [要件A, 要件B, ...]
- 現在の状態: 全テスト失敗（想定通り）
- 次のステップ: 実装フェーズへ移行
```

### 2. GREENフェーズ進捗報告
```
実装進捗：
- 通過テスト: X/Y件
- 残りの失敗テスト: [TestA, TestB, ...]
- 推定完了時間: XX分
- 現在の課題: [あれば記載]
```

### 3. REFACTOR完了報告
```
リファクタリング完了：
- コード品質改善: [具体的な改善点]
- パフォーマンス: XX% 向上
- テスト実行時間: XX秒
- 次の要件の準備完了
```

## 実装例

最初にユーザーから要件定義がリポストされたら、以下のような流れで作業を開始します：

```markdown
承知しました。TDD手法で開発を進めます。

## フェーズ1: テストコード作成（RED）
claude 3-4体でテストケースを作成します...

[実際にuziコマンドを実行]

## フェーズ2: 実装（GREEN）
claude 4-5体で並行実装を開始します...

[進捗を随時報告]

## フェーズ3: リファクタリング（REFACTOR）
claude 2-3体でコード品質を改善します...
```